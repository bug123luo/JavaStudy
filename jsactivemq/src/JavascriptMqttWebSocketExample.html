<html>
<head>
<title>JavaScript MQTT WebSocket Example</title>
<style></style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<script type="text/javascript" language="javascript">

var mqtt;
var reconnectTimeout=2000;
var host="192.168.0.100";
var port=61614;
var topic="TestTopic";
var subscribeOptions={qos:2};

function onFailure(message){
	console.log("Connection Attempt to Host "+ host+" Failed");
	setTimeout(MQTTconnect, reconnectTimeout);
}

function onMessageArrived(msg){
	out_msg="Message received "+msg.payloadString + "<br>";
	out_msg=out_msg+" Message received Topic "+msg.destinationName;
	console.log(out_msg);
}

function onConnect(){
	console.log("Connected");
	message = new Paho.MQTT.Message("HelloWorld");
	message.destinationName="TestTopic";
	//mqtt.send(message);
	mqtt.subscribe(topic,subscribeOptions);
} 

function MQTTconnect(){
	console.log("connecting to "+host+" "+port);
	mqtt=new Paho.MQTT.Client(host,port,"clientjs");
	
	var options={
		timeout:3,
		onSuccess:onConnect,
		onFailure:onFailure,
		cleanSession:false,
	};
	
	mqtt.onMessageArrived=onMessageArrived
	
	mqtt.connect(options);
}
</script>
</head>
<body>
<h1>Main Body</h1>
<script>
MQTTconnect();
</script>
</body>
</html>